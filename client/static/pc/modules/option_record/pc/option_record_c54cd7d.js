define("option_record/pc/option_record",function(a){var e=a("components/jquery/jquery.js"),d=Handlebars.template(function(a,e,d,r,n){return this.compilerInfo=[4,">= 1.0.0"],d=this.merge(d,a.helpers),n=n||{},'<div class="ds-box options_record_panel orient-v fn-hide" data-role="options_record_panel">\r\n    <div class="ds-box pack-justify panel_head" data-role="record_panel_head">\r\n        <div class="panel_head_option"></div>\r\n        <div class="panel_head_title" data-role="panel_head_title">聊天记录</div>\r\n        <div class="panel_head_option" data-role="panel_head_close">关闭</div>\r\n    </div>\r\n    <div class="ds-box panel_body flex-1" data-role="record_panel_body">\r\n        <div class="ds-box pack-center record_part_empty flex-1" data-role="all_empty">----未选择商家----</div>\r\n        <div class="ds-box orient-v record_buyer_list fn-hide" data-role="record_buyer_list"></div>\r\n        <div class="ds-box orient-v record_ops flex-1 fn-hide" data-role="record_ops">\r\n            <div class="ds-box orient-v extra pack-center">\r\n                <!--div class="ds-box flex-1 ops fn-hide">\r\n                    <div class="ds-box align-center add_to_list" data-role="record_add_to_list">发起会话</div>\r\n                </div-->\r\n                <div class="more fn-hide" data-role="record_more">查看更多消息</div>\r\n                <div class="more fn-hide" data-role="record_more_load">加载中</div>\r\n                <div class="more fn-hide" data-role="record_more_end">没有更多的记录</div>\r\n            </div>\r\n            <div class="ds-box orient-v record_buyer_msg flex-1" data-role="record_buyer_msg"></div>\r\n        </div>\r\n\r\n\r\n        </div>\r\n\r\n</div>'}),r=Handlebars.template(function(a,e,d,r,n){function s(a,e){var r,n,s="";return s+='\r\n    <div class="ds-box align-center pack-center inner_item " data-role="record_inner_item" data-record-buyer_id="',(n=d.id)?r=n.call(a,{hash:{},data:e}):(n=a&&a.id,r=typeof n===l?n.call(a,{hash:{},data:e}):n),s+=i(r)+'">\r\n        <div>',(n=d.id)?r=n.call(a,{hash:{},data:e}):(n=a&&a.id,r=typeof n===l?n.call(a,{hash:{},data:e}):n),s+=i(r)+"</div>\r\n    </div>\r\n"}this.compilerInfo=[4,">= 1.0.0"],d=this.merge(d,a.helpers),n=n||{};var t,o="",l="function",i=this.escapeExpression,c=this;return t=d.each.call(e,e&&e.data,{hash:{},inverse:c.noop,fn:c.program(1,s,n),data:n}),(t||0===t)&&(o+=t),o+="\r\n"}),n=Handlebars.template(function(a,e,d,r,n){function s(a,e){var r,n,s,o="";return o+="\r\n    ",n=d.compare||a&&a.compare,s={hash:{},inverse:y.noop,fn:y.program(2,t,e),data:e},r=n?n.call(a,a&&a.send_user_role,"==","yuebuyer",s):g.call(a,"compare",a&&a.send_user_role,"==","yuebuyer",s),(r||0===r)&&(o+=r),o+="\r\n    ",n=d.compare||a&&a.compare,s={hash:{},inverse:y.noop,fn:y.program(13,h,e),data:e},r=n?n.call(a,a&&a.send_user_role,"==","yueseller",s):g.call(a,"compare",a&&a.send_user_role,"==","yueseller",s),(r||0===r)&&(o+=r),o+="\r\n\r\n"}function t(a,e){var r,n,s,t="";return t+="\r\n        ",n=d.compare||a&&a.compare,s={hash:{},inverse:y.noop,fn:y.program(3,o,e),data:e},r=n?n.call(a,a&&a.media_type,"==","text",s):g.call(a,"compare",a&&a.media_type,"==","text",s),(r||0===r)&&(t+=r),t+="\r\n        ",n=d.compare||a&&a.compare,s={hash:{},inverse:y.noop,fn:y.program(5,l,e),data:e},r=n?n.call(a,a&&a.media_type,"==","photo",s):g.call(a,"compare",a&&a.media_type,"==","photo",s),(r||0===r)&&(t+=r),t+="\r\n        ",n=d.compare||a&&a.compare,s={hash:{},inverse:y.noop,fn:y.program(7,i,e),data:e},r=n?n.call(a,a&&a.media_type,"==","sound",s):g.call(a,"compare",a&&a.media_type,"==","sound",s),(r||0===r)&&(t+=r),t+="\r\n        ",n=d.compare||a&&a.compare,s={hash:{},inverse:y.noop,fn:y.program(9,c,e),data:e},r=n?n.call(a,a&&a.media_type,"==","merchandise",s):g.call(a,"compare",a&&a.media_type,"==","merchandise",s),(r||0===r)&&(t+=r),t+="\r\n        ",n=d.compare||a&&a.compare,s={hash:{},inverse:y.noop,fn:y.program(11,_,e),data:e},r=n?n.call(a,a&&a.media_type,"==","card",s):g.call(a,"compare",a&&a.media_type,"==","card",s),(r||0===r)&&(t+=r),t+="\r\n    "}function o(a,e){var r,n,s="";return s+='\r\n            <div class="ds-box inner_msg orient-v receive">\r\n                <div class="ds-box msg_head">\r\n                    <div class="font">',(n=d.send_user_id)?r=n.call(a,{hash:{},data:e}):(n=a&&a.send_user_id,r=typeof n===m?n.call(a,{hash:{},data:e}):n),s+=b(r)+'</div>\r\n                    <div class="font">',(n=d.send_time)?r=n.call(a,{hash:{},data:e}):(n=a&&a.send_time,r=typeof n===m?n.call(a,{hash:{},data:e}):n),s+=b(r)+'</div>\r\n                    <div class="font">',(n=d.send_hour)?r=n.call(a,{hash:{},data:e}):(n=a&&a.send_hour,r=typeof n===m?n.call(a,{hash:{},data:e}):n),s+=b(r)+'</div>\r\n                </div>\r\n                <div class="ds-box msg_body">',(n=d.content)?r=n.call(a,{hash:{},data:e}):(n=a&&a.content,r=typeof n===m?n.call(a,{hash:{},data:e}):n),s+=b(r)+"</div>\r\n            </div>\r\n        "}function l(a,e){var r,n,s="";return s+='\r\n            <div class="ds-box inner_msg orient-v receive">\r\n                <div class="ds-box msg_head">\r\n                    <div class="font">',(n=d.send_user_id)?r=n.call(a,{hash:{},data:e}):(n=a&&a.send_user_id,r=typeof n===m?n.call(a,{hash:{},data:e}):n),s+=b(r)+'</div>\r\n                    <div class="font">',(n=d.send_time)?r=n.call(a,{hash:{},data:e}):(n=a&&a.send_time,r=typeof n===m?n.call(a,{hash:{},data:e}):n),s+=b(r)+'</div>\r\n                    <div class="font">',(n=d.send_hour)?r=n.call(a,{hash:{},data:e}):(n=a&&a.send_hour,r=typeof n===m?n.call(a,{hash:{},data:e}):n),s+=b(r)+'</div>\r\n                    <div class="reload" data-role="img_reload">重新加载</div>\r\n                </div>\r\n                <div class="ds-box msg_body">\r\n                    <img src="',(n=d.file_url)?r=n.call(a,{hash:{},data:e}):(n=a&&a.file_url,r=typeof n===m?n.call(a,{hash:{},data:e}):n),s+=b(r)+'" style="height: 50px;" data-role="options_show_img" data-reload="',(n=d.file_url)?r=n.call(a,{hash:{},data:e}):(n=a&&a.file_url,r=typeof n===m?n.call(a,{hash:{},data:e}):n),s+=b(r)+'"/>\r\n                </div>\r\n            </div>\r\n        '}function i(a,e){var r,n,s="";return s+='\r\n            <div class="ds-box inner_msg orient-v receive">\r\n                <div class="ds-box msg_head">\r\n                    <div class="font">',(n=d.send_user_id)?r=n.call(a,{hash:{},data:e}):(n=a&&a.send_user_id,r=typeof n===m?n.call(a,{hash:{},data:e}):n),s+=b(r)+'</div>\r\n                    <div class="font">',(n=d.send_time)?r=n.call(a,{hash:{},data:e}):(n=a&&a.send_time,r=typeof n===m?n.call(a,{hash:{},data:e}):n),s+=b(r)+'</div>\r\n                    <div class="font">',(n=d.send_hour)?r=n.call(a,{hash:{},data:e}):(n=a&&a.send_hour,r=typeof n===m?n.call(a,{hash:{},data:e}):n),s+=b(r)+'</div>\r\n                </div>\r\n                <div class="ds-box msg_body">\r\n                    <div data-role="record_play_sound" data-record-sound-url="',(n=d.file_url)?r=n.call(a,{hash:{},data:e}):(n=a&&a.file_url,r=typeof n===m?n.call(a,{hash:{},data:e}):n),s+=b(r)+'">\r\n                        <div class="sound_click" data-role="record_sound_click">---这是一段语音---</div>\r\n                        <audio class="fn-hide" controls="controls" type="audio/mp3" src="" data-role="record_sound_line"></audio>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        '}function c(a,e){var r,n,s="";return s+='\r\n            <div class="ds-box inner_msg orient-v receive">\r\n                <div class="ds-box msg_head">\r\n                    <div class="font">',(n=d.send_user_id)?r=n.call(a,{hash:{},data:e}):(n=a&&a.send_user_id,r=typeof n===m?n.call(a,{hash:{},data:e}):n),s+=b(r)+'</div>\r\n                    <div class="font">',(n=d.send_time)?r=n.call(a,{hash:{},data:e}):(n=a&&a.send_time,r=typeof n===m?n.call(a,{hash:{},data:e}):n),s+=b(r)+'</div>\r\n                    <div class="font">',(n=d.send_hour)?r=n.call(a,{hash:{},data:e}):(n=a&&a.send_hour,r=typeof n===m?n.call(a,{hash:{},data:e}):n),s+=b(r)+'</div>\r\n                </div>\r\n                <div class="ds-box msg_body">\r\n                    <div class="ds-box orient-v merc">\r\n                        <div class="info_title">',(n=d.card_text1)?r=n.call(a,{hash:{},data:e}):(n=a&&a.card_text1,r=typeof n===m?n.call(a,{hash:{},data:e}):n),s+=b(r)+'</div>\r\n                        <div class="info_price">',(n=d.card_text2)?r=n.call(a,{hash:{},data:e}):(n=a&&a.card_text2,r=typeof n===m?n.call(a,{hash:{},data:e}):n),s+=b(r)+"</div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        "}function _(a,e){var r,n,s="";return s+='\r\n            <div class="ds-box inner_msg orient-v receive">\r\n                <div class="ds-box msg_head">\r\n                    <div class="font">',(n=d.send_user_id)?r=n.call(a,{hash:{},data:e}):(n=a&&a.send_user_id,r=typeof n===m?n.call(a,{hash:{},data:e}):n),s+=b(r)+'</div>\r\n                    <div class="font">',(n=d.send_time)?r=n.call(a,{hash:{},data:e}):(n=a&&a.send_time,r=typeof n===m?n.call(a,{hash:{},data:e}):n),s+=b(r)+'</div>\r\n                    <div class="font">',(n=d.send_hour)?r=n.call(a,{hash:{},data:e}):(n=a&&a.send_hour,r=typeof n===m?n.call(a,{hash:{},data:e}):n),s+=b(r)+'</div>\r\n                </div>\r\n                <div class="ds-box msg_body">\r\n                    <div class="ds-box orient-v card">\r\n                        <!--div class="info_title">',(n=d.card_title)?r=n.call(a,{hash:{},data:e}):(n=a&&a.card_title,r=typeof n===m?n.call(a,{hash:{},data:e}):n),s+=b(r)+'</div-->\r\n                        <div class="info_title">',(n=d.card_text1)?r=n.call(a,{hash:{},data:e}):(n=a&&a.card_text1,r=typeof n===m?n.call(a,{hash:{},data:e}):n),s+=b(r)+'</div>\r\n                        <div class="info_price">',(n=d.card_text2)?r=n.call(a,{hash:{},data:e}):(n=a&&a.card_text2,r=typeof n===m?n.call(a,{hash:{},data:e}):n),s+=b(r)+"</div>\r\n                    </div>\r\n                </div>\r\n\r\n            </div>\r\n        "}function h(a,e){var r,n,s,t="";return t+="\r\n        ",n=d.compare||a&&a.compare,s={hash:{},inverse:y.noop,fn:y.program(14,p,e),data:e},r=n?n.call(a,a&&a.media_type,"==","text",s):g.call(a,"compare",a&&a.media_type,"==","text",s),(r||0===r)&&(t+=r),t+="\r\n        ",n=d.compare||a&&a.compare,s={hash:{},inverse:y.noop,fn:y.program(16,v,e),data:e},r=n?n.call(a,a&&a.media_type,"==","photo",s):g.call(a,"compare",a&&a.media_type,"==","photo",s),(r||0===r)&&(t+=r),t+="\r\n        ",n=d.compare||a&&a.compare,s={hash:{},inverse:y.noop,fn:y.program(18,f,e),data:e},r=n?n.call(a,a&&a.media_type,"==","merchandise",s):g.call(a,"compare",a&&a.media_type,"==","merchandise",s),(r||0===r)&&(t+=r),t+="\r\n    "}function p(a,e){var r,n,s="";return s+='\r\n            <div class="ds-box inner_msg orient-v send">\r\n                <div class="ds-box msg_head">\r\n                    <div class="font">',(n=d.send_user_id)?r=n.call(a,{hash:{},data:e}):(n=a&&a.send_user_id,r=typeof n===m?n.call(a,{hash:{},data:e}):n),s+=b(r)+'</div>\r\n                    <div class="font">',(n=d.send_time)?r=n.call(a,{hash:{},data:e}):(n=a&&a.send_time,r=typeof n===m?n.call(a,{hash:{},data:e}):n),s+=b(r)+'</div>\r\n                    <div class="font">',(n=d.send_hour)?r=n.call(a,{hash:{},data:e}):(n=a&&a.send_hour,r=typeof n===m?n.call(a,{hash:{},data:e}):n),s+=b(r)+'</div>\r\n                </div>\r\n                <div class="ds-box msg_body">',(n=d.content)?r=n.call(a,{hash:{},data:e}):(n=a&&a.content,r=typeof n===m?n.call(a,{hash:{},data:e}):n),s+=b(r)+"</div>\r\n            </div>\r\n        "}function v(a,e){var r,n,s="";return s+='\r\n            <div class="ds-box inner_msg orient-v send">\r\n                <div class="ds-box msg_head">\r\n                    <div class="font">',(n=d.send_user_id)?r=n.call(a,{hash:{},data:e}):(n=a&&a.send_user_id,r=typeof n===m?n.call(a,{hash:{},data:e}):n),s+=b(r)+'</div>\r\n                    <div class="font">',(n=d.send_time)?r=n.call(a,{hash:{},data:e}):(n=a&&a.send_time,r=typeof n===m?n.call(a,{hash:{},data:e}):n),s+=b(r)+'</div>\r\n                    <div class="font">',(n=d.send_hour)?r=n.call(a,{hash:{},data:e}):(n=a&&a.send_hour,r=typeof n===m?n.call(a,{hash:{},data:e}):n),s+=b(r)+'</div>\r\n                    <div class="reload" data-role="img_reload">重新加载</div>\r\n                </div>\r\n                <div class="ds-box msg_body">\r\n                    <img src="',(n=d.file_url)?r=n.call(a,{hash:{},data:e}):(n=a&&a.file_url,r=typeof n===m?n.call(a,{hash:{},data:e}):n),s+=b(r)+'" style="height: 50px;" data-role="options_show_img" data-reload="',(n=d.file_url)?r=n.call(a,{hash:{},data:e}):(n=a&&a.file_url,r=typeof n===m?n.call(a,{hash:{},data:e}):n),s+=b(r)+'"/>\r\n                </div>\r\n            </div>\r\n        '}function f(a,e){var r,n,s="";return s+='\r\n            <div class="ds-box inner_msg orient-v send">\r\n                <div class="ds-box msg_head">\r\n                    <div class="font">',(n=d.send_user_id)?r=n.call(a,{hash:{},data:e}):(n=a&&a.send_user_id,r=typeof n===m?n.call(a,{hash:{},data:e}):n),s+=b(r)+'</div>\r\n                    <div class="font">',(n=d.send_time)?r=n.call(a,{hash:{},data:e}):(n=a&&a.send_time,r=typeof n===m?n.call(a,{hash:{},data:e}):n),s+=b(r)+'</div>\r\n                    <div class="font">',(n=d.send_hour)?r=n.call(a,{hash:{},data:e}):(n=a&&a.send_hour,r=typeof n===m?n.call(a,{hash:{},data:e}):n),s+=b(r)+'</div>\r\n                </div>\r\n                <div class="ds-box msg_body">\r\n                    <div class="ds-box orient-v merc">\r\n                        <div class="info_title">',(n=d.card_text1)?r=n.call(a,{hash:{},data:e}):(n=a&&a.card_text1,r=typeof n===m?n.call(a,{hash:{},data:e}):n),s+=b(r)+'</div>\r\n                        <div class="info_price">',(n=d.card_text2)?r=n.call(a,{hash:{},data:e}):(n=a&&a.card_text2,r=typeof n===m?n.call(a,{hash:{},data:e}):n),s+=b(r)+"</div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        "}this.compilerInfo=[4,">= 1.0.0"],d=this.merge(d,a.helpers),n=n||{};var u,m="function",b=this.escapeExpression,y=this,g=d.helperMissing;return u=d.each.call(e,e&&e.data,{hash:{},inverse:y.noop,fn:y.program(1,s,n),data:n}),u||0===u?u:""}),s={msg_list_page:1,init:function(a){var e=this;e.contain=a.bar,e.load_success=a.load_success||function(){},e.load_fail=a.load_fail||function(){},e.click_pictures=a.click_pictures||function(){},e.click_close=a.click_close||function(){},e.role=a.role||"seller",e.render()},render:function(){var a=this,r=d();a.contain.append(r),a.panel_obj=e('[data-role="options_record_panel"]'),a.event()},show:function(){var a=this;a.panel_obj.removeClass("fn-hide"),a.panel_obj.find('[data-role="panel_head_title"]').html("聊天记录")},hide:function(){var a=this;a.panel_obj.addClass("fn-hide")},event:function(){var a=this;a.panel_head=a.panel_obj.find('[data-role="record_panel_head"]'),a.panel_head.on("mousedown",function(e){var d=e.offsetX,r=e.offsetY;a.panel_head.unbind("mousemove").on("mousemove",function(e){var n=e.offsetX,s=e.offsetY,t=n-d,o=s-r,l=a.panel_obj.css("top");l=parseInt(l.substring(0,l.indexOf("px")));var i=a.panel_obj.css("left");i=parseInt(i.substring(0,i.indexOf("px"))),a.panel_obj.css({top:l+o,left:i+t})})}),a.panel_head.on("mouseup mouseleave",function(){a.panel_head.unbind("mousemove")}),a.panel_obj.find('[data-role="record_more"]').on("click",function(){a.msg_list_page++,a.load(a.submit_obj)}),a.panel_obj.find('[data-role="record_buyer_msg"]').on("scroll",function(e){a.on_bot=e.currentTarget.scrollHeight-e.currentTarget.scrollTop}),a.panel_obj.find('[data-role="panel_head_close"]').on("click",function(){"function"==typeof a.click_close&&a.click_close.call(this)})},load:function(a){var d=this;if(!d.loading&&(d.submit_obj=e.extend(!0,{},a,{page:d.msg_list_page}),d.tips_more=d.panel_obj.find('[data-role="record_more"]'),d.tips_load=d.panel_obj.find('[data-role="record_more_load"]'),d.tips_end=d.panel_obj.find('[data-role="record_more_end"]'),d.tips_more.addClass("fn-hide"),d.tips_load.removeClass("fn-hide"),d.tips_end.addClass("fn-hide"),d.submit_obj.seller_id)){var s;s="seller"==d.role?window.$__ajax_domain+"get_msg_list.php":window.$__ajax_domain+"get_msg_list_buyer.php",e.ajax({url:s,data:d.submit_obj,dataType:"json",type:"POST",cache:!1,beforeSend:function(){d.loading=!0},success:function(s){d.panel_obj.find('[data-role="panel_head_title"]').html(d.submit_obj.seller_id+"聊天记录"),d.panel_obj.find('[data-role="all_empty"]').addClass("fn-hide"),d.panel_obj.find('[data-role="record_ops"]').removeClass("fn-hide");var t=[],o=[];if(s.result_data.buyer_list.list){e.each(s.result_data.buyer_list.list,function(e,d){var r,n=JSON.parse(d);r=n.send_user_id==a.seller_id?{id:n.to_user_id,pack:n}:{id:n.send_user_id,pack:n},t.push(r)});{r({data:t})}}if(s.result_data.buyer_msg&&0!=s.result_data.buyer_msg.list.length?(d.tips_more.removeClass("fn-hide"),d.tips_load.addClass("fn-hide")):(d.tips_end.removeClass("fn-hide"),d.tips_more.addClass("fn-hide"),d.tips_load.addClass("fn-hide")),s.result_data.buyer_msg&&s.result_data.buyer_msg.list){e.each(s.result_data.buyer_msg.list,function(a,e){var d=JSON.parse(e),r=new Date(1e3*d.send_time);d.send_time=r.getFullYear()+"-"+(r.getMonth()+1)+"-"+r.getDate(),d.send_hour=r.getHours()+":"+r.getMinutes()+":"+r.getSeconds(),o.push(d)}),console.log(o);var l=n({data:o});d.panel_obj.find('[data-role="record_buyer_msg"]').prepend(l)}d.panel_obj.find("[data-record-buyer_id]").removeClass("current"),d.panel_obj.find('[data-record-buyer_id="'+a.buyer_id+'"]').addClass("current");var i=d.panel_obj.find('[data-role="record_buyer_msg"]')[0].scrollHeight-d.on_bot;d.panel_obj.find('[data-role="record_buyer_msg"]').scrollTop(i),d._bind_event(),"function"==typeof d.load_success&&d.load_success.call(this,s,d)},error:function(a){"function"==typeof d.load_fail&&d.load_fail.call(this,a,d),d.tips_more.removeClass("fn-hide"),d.tips_load.addClass("fn-hide")},complete:function(){d.loading=!1}})}},_bind_event:function(){var a=this;a.panel_obj.find('[data-role="options_show_img"]').unbind("click").on("click",function(){var d=e(this).attr("src");"function"==typeof a.click_pictures&&a.click_pictures.call(this,d)}),e.each(a.panel_obj.find('[data-role="record_sound_line"]'),function(a,d){var r=e(d),n=r.parents("[data-record-sound-url]").attr("data-record-sound-url"),s=window.btoa(JSON.stringify({url:n}));r[0].onloadedmetadata=function(){0==r.siblings('[data-role="record_sound_click"]').find("font").length&&r.siblings('[data-role="record_sound_click"]').append("<font>"+r[0].duration.toFixed(1)+'"</font>')},r.attr("src","http://14.29.52.16:8055/ogg2mp3?req="+s)}),a.panel_obj.find('[data-role="record_play_sound"]').unbind("click").on("click",function(){var a=e(this),d=a.find('[data-role="record_sound_line"]');d[0].paused?d[0].play():d[0].pause()}),a.panel_obj.find('[data-role="record_inner_item"]').unbind("click").on("click",function(){a.panel_obj.find('[data-role="record_buyer_msg"]').html(""),a.reset_msg_list_page(),a.submit_obj=e.extend(!0,{},a.submit_obj,{buyer_id:e(this).attr("data-record-buyer_id")}),a.load(a.submit_obj)}),a.panel_obj.find('[data-role="img_reload"]').unbind("click").on("click",function(){var a=e(this),d=a.parents(".inner_msg").find('[data-role="options_show_img"]'),r=d.attr("data-reload");0==r.indexOf("http://")&&d.attr("src",r+"?"+(new Date).getTime())})},reset_msg_list_page:function(){var a=this;a.panel_obj.find('[data-role="record_buyer_msg"]').html(""),a.msg_list_page=1}};return s});