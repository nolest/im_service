define("option_record/pc/option_record",function(a){var e=a("components/jquery/jquery.js"),d=Handlebars.template(function(a,e,d,r,s){return this.compilerInfo=[4,">= 1.0.0"],d=this.merge(d,a.helpers),s=s||{},'<div class="ds-box options_record_panel orient-v fn-hide" data-role="options_record_panel">\r\n    <div class="ds-box pack-justify panel_head" data-role="record_panel_head">\r\n        <div class="panel_head_option"></div>\r\n        <div class="panel_head_title" data-role="panel_head_title">聊天记录</div>\r\n        <div class="panel_head_option"></div>\r\n    </div>\r\n    <div class="ds-box panel_body flex-1" data-role="record_panel_body">\r\n        <div class="ds-box pack-center record_part_empty flex-1" data-role="all_empty">----未选择商家----</div>\r\n        <div class="ds-box orient-v record_buyer_list fn-hide" data-role="record_buyer_list"></div>\r\n        <div class="ds-box orient-v record_ops flex-1 fn-hide" data-role="record_ops">\r\n            <div class="ds-box orient-v extra pack-center">\r\n                <!--div class="ds-box flex-1 ops fn-hide">\r\n                    <div class="ds-box align-center add_to_list" data-role="record_add_to_list">发起会话</div>\r\n                </div-->\r\n                <div class="more fn-hide" data-role="record_more">查看更多消息</div>\r\n                <div class="more fn-hide" data-role="record_more_load">加载中</div>\r\n                <div class="more fn-hide" data-role="record_more_end">没有更多的记录</div>\r\n            </div>\r\n            <div class="ds-box orient-v record_buyer_msg flex-1" data-role="record_buyer_msg"></div>\r\n        </div>\r\n\r\n\r\n        </div>\r\n\r\n</div>'}),r=Handlebars.template(function(a,e,d,r,s){function n(a,e){var r,s,n="";return n+='\r\n    <div class="ds-box align-center pack-center inner_item " data-role="record_inner_item" data-record-buyer_id="',(s=d.id)?r=s.call(a,{hash:{},data:e}):(s=a&&a.id,r=typeof s===i?s.call(a,{hash:{},data:e}):s),n+=l(r)+'">\r\n        <div>',(s=d.id)?r=s.call(a,{hash:{},data:e}):(s=a&&a.id,r=typeof s===i?s.call(a,{hash:{},data:e}):s),n+=l(r)+"</div>\r\n    </div>\r\n"}this.compilerInfo=[4,">= 1.0.0"],d=this.merge(d,a.helpers),s=s||{};var t,o="",i="function",l=this.escapeExpression,c=this;return t=d.each.call(e,e&&e.data,{hash:{},inverse:c.noop,fn:c.program(1,n,s),data:s}),(t||0===t)&&(o+=t),o+="\r\n"}),s=Handlebars.template(function(a,e,d,r,s){function n(a,e){var r,s,n,o="";return o+="\r\n    ",s=d.compare||a&&a.compare,n={hash:{},inverse:y.noop,fn:y.program(2,t,e),data:e},r=s?s.call(a,a&&a.send_user_role,"==","yuebuyer",n):g.call(a,"compare",a&&a.send_user_role,"==","yuebuyer",n),(r||0===r)&&(o+=r),o+="\r\n    ",s=d.compare||a&&a.compare,n={hash:{},inverse:y.noop,fn:y.program(13,h,e),data:e},r=s?s.call(a,a&&a.send_user_role,"==","yueseller",n):g.call(a,"compare",a&&a.send_user_role,"==","yueseller",n),(r||0===r)&&(o+=r),o+="\r\n\r\n"}function t(a,e){var r,s,n,t="";return t+="\r\n        ",s=d.compare||a&&a.compare,n={hash:{},inverse:y.noop,fn:y.program(3,o,e),data:e},r=s?s.call(a,a&&a.media_type,"==","text",n):g.call(a,"compare",a&&a.media_type,"==","text",n),(r||0===r)&&(t+=r),t+="\r\n        ",s=d.compare||a&&a.compare,n={hash:{},inverse:y.noop,fn:y.program(5,i,e),data:e},r=s?s.call(a,a&&a.media_type,"==","photo",n):g.call(a,"compare",a&&a.media_type,"==","photo",n),(r||0===r)&&(t+=r),t+="\r\n        ",s=d.compare||a&&a.compare,n={hash:{},inverse:y.noop,fn:y.program(7,l,e),data:e},r=s?s.call(a,a&&a.media_type,"==","sound",n):g.call(a,"compare",a&&a.media_type,"==","sound",n),(r||0===r)&&(t+=r),t+="\r\n        ",s=d.compare||a&&a.compare,n={hash:{},inverse:y.noop,fn:y.program(9,c,e),data:e},r=s?s.call(a,a&&a.media_type,"==","merchandise",n):g.call(a,"compare",a&&a.media_type,"==","merchandise",n),(r||0===r)&&(t+=r),t+="\r\n        ",s=d.compare||a&&a.compare,n={hash:{},inverse:y.noop,fn:y.program(11,_,e),data:e},r=s?s.call(a,a&&a.media_type,"==","card",n):g.call(a,"compare",a&&a.media_type,"==","card",n),(r||0===r)&&(t+=r),t+="\r\n    "}function o(a,e){var r,s,n="";return n+='\r\n            <div class="ds-box inner_msg orient-v receive">\r\n                <div class="ds-box msg_head">\r\n                    <div class="font">',(s=d.send_user_id)?r=s.call(a,{hash:{},data:e}):(s=a&&a.send_user_id,r=typeof s===m?s.call(a,{hash:{},data:e}):s),n+=b(r)+'</div>\r\n                    <div class="font">',(s=d.send_time)?r=s.call(a,{hash:{},data:e}):(s=a&&a.send_time,r=typeof s===m?s.call(a,{hash:{},data:e}):s),n+=b(r)+'</div>\r\n                    <div class="font">',(s=d.send_hour)?r=s.call(a,{hash:{},data:e}):(s=a&&a.send_hour,r=typeof s===m?s.call(a,{hash:{},data:e}):s),n+=b(r)+'</div>\r\n                </div>\r\n                <div class="ds-box msg_body">',(s=d.content)?r=s.call(a,{hash:{},data:e}):(s=a&&a.content,r=typeof s===m?s.call(a,{hash:{},data:e}):s),n+=b(r)+"</div>\r\n            </div>\r\n        "}function i(a,e){var r,s,n="";return n+='\r\n            <div class="ds-box inner_msg orient-v receive">\r\n                <div class="ds-box msg_head">\r\n                    <div class="font">',(s=d.send_user_id)?r=s.call(a,{hash:{},data:e}):(s=a&&a.send_user_id,r=typeof s===m?s.call(a,{hash:{},data:e}):s),n+=b(r)+'</div>\r\n                    <div class="font">',(s=d.send_time)?r=s.call(a,{hash:{},data:e}):(s=a&&a.send_time,r=typeof s===m?s.call(a,{hash:{},data:e}):s),n+=b(r)+'</div>\r\n                    <div class="font">',(s=d.send_hour)?r=s.call(a,{hash:{},data:e}):(s=a&&a.send_hour,r=typeof s===m?s.call(a,{hash:{},data:e}):s),n+=b(r)+'</div>\r\n                </div>\r\n                <div class="ds-box msg_body">\r\n                    <img src="',(s=d.file_url)?r=s.call(a,{hash:{},data:e}):(s=a&&a.file_url,r=typeof s===m?s.call(a,{hash:{},data:e}):s),n+=b(r)+'" style="height: 50px;" data-role="options_show_img"/>\r\n                </div>\r\n            </div>\r\n        '}function l(a,e){var r,s,n="";return n+='\r\n            <div class="ds-box inner_msg orient-v receive">\r\n                <div class="ds-box msg_head">\r\n                    <div class="font">',(s=d.send_user_id)?r=s.call(a,{hash:{},data:e}):(s=a&&a.send_user_id,r=typeof s===m?s.call(a,{hash:{},data:e}):s),n+=b(r)+'</div>\r\n                    <div class="font">',(s=d.send_time)?r=s.call(a,{hash:{},data:e}):(s=a&&a.send_time,r=typeof s===m?s.call(a,{hash:{},data:e}):s),n+=b(r)+'</div>\r\n                    <div class="font">',(s=d.send_hour)?r=s.call(a,{hash:{},data:e}):(s=a&&a.send_hour,r=typeof s===m?s.call(a,{hash:{},data:e}):s),n+=b(r)+'</div>\r\n                </div>\r\n                <div class="ds-box msg_body">\r\n                    <div data-role="record_play_sound" data-record-sound-url="',(s=d.file_url)?r=s.call(a,{hash:{},data:e}):(s=a&&a.file_url,r=typeof s===m?s.call(a,{hash:{},data:e}):s),n+=b(r)+'">\r\n                        <div class="sound_click" data-role="record_sound_click">语音</div>\r\n                        <audio class="fn-hide" controls="controls" type="audio/mp3" src="" data-role="record_sound_line"></audio>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        '}function c(a,e){var r,s,n="";return n+='\r\n            <div class="ds-box inner_msg orient-v receive">\r\n                <div class="ds-box msg_head">\r\n                    <div class="font">',(s=d.send_user_id)?r=s.call(a,{hash:{},data:e}):(s=a&&a.send_user_id,r=typeof s===m?s.call(a,{hash:{},data:e}):s),n+=b(r)+'</div>\r\n                    <div class="font">',(s=d.send_time)?r=s.call(a,{hash:{},data:e}):(s=a&&a.send_time,r=typeof s===m?s.call(a,{hash:{},data:e}):s),n+=b(r)+'</div>\r\n                    <div class="font">',(s=d.send_hour)?r=s.call(a,{hash:{},data:e}):(s=a&&a.send_hour,r=typeof s===m?s.call(a,{hash:{},data:e}):s),n+=b(r)+'</div>\r\n                </div>\r\n                <div class="ds-box msg_body">\r\n                    <div class="ds-box orient-v merc">\r\n                        <div class="info_title">',(s=d.card_text1)?r=s.call(a,{hash:{},data:e}):(s=a&&a.card_text1,r=typeof s===m?s.call(a,{hash:{},data:e}):s),n+=b(r)+'</div>\r\n                        <div class="info_price">',(s=d.card_text2)?r=s.call(a,{hash:{},data:e}):(s=a&&a.card_text2,r=typeof s===m?s.call(a,{hash:{},data:e}):s),n+=b(r)+"</div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        "}function _(a,e){var r,s,n="";return n+='\r\n            <div class="ds-box inner_msg orient-v receive">\r\n                <div class="ds-box msg_head">\r\n                    <div class="font">',(s=d.send_user_id)?r=s.call(a,{hash:{},data:e}):(s=a&&a.send_user_id,r=typeof s===m?s.call(a,{hash:{},data:e}):s),n+=b(r)+'</div>\r\n                    <div class="font">',(s=d.send_time)?r=s.call(a,{hash:{},data:e}):(s=a&&a.send_time,r=typeof s===m?s.call(a,{hash:{},data:e}):s),n+=b(r)+'</div>\r\n                    <div class="font">',(s=d.send_hour)?r=s.call(a,{hash:{},data:e}):(s=a&&a.send_hour,r=typeof s===m?s.call(a,{hash:{},data:e}):s),n+=b(r)+'</div>\r\n                </div>\r\n                <div class="ds-box msg_body">\r\n                    <div class="ds-box orient-v card">\r\n                        <!--div class="info_title">',(s=d.card_title)?r=s.call(a,{hash:{},data:e}):(s=a&&a.card_title,r=typeof s===m?s.call(a,{hash:{},data:e}):s),n+=b(r)+'</div-->\r\n                        <div class="info_title">',(s=d.card_text1)?r=s.call(a,{hash:{},data:e}):(s=a&&a.card_text1,r=typeof s===m?s.call(a,{hash:{},data:e}):s),n+=b(r)+'</div>\r\n                        <div class="info_price">',(s=d.card_text2)?r=s.call(a,{hash:{},data:e}):(s=a&&a.card_text2,r=typeof s===m?s.call(a,{hash:{},data:e}):s),n+=b(r)+"</div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        "}function h(a,e){var r,s,n,t="";return t+="\r\n        ",s=d.compare||a&&a.compare,n={hash:{},inverse:y.noop,fn:y.program(14,p,e),data:e},r=s?s.call(a,a&&a.media_type,"==","text",n):g.call(a,"compare",a&&a.media_type,"==","text",n),(r||0===r)&&(t+=r),t+="\r\n        ",s=d.compare||a&&a.compare,n={hash:{},inverse:y.noop,fn:y.program(16,v,e),data:e},r=s?s.call(a,a&&a.media_type,"==","photo",n):g.call(a,"compare",a&&a.media_type,"==","photo",n),(r||0===r)&&(t+=r),t+="\r\n        ",s=d.compare||a&&a.compare,n={hash:{},inverse:y.noop,fn:y.program(18,f,e),data:e},r=s?s.call(a,a&&a.media_type,"==","merchandise",n):g.call(a,"compare",a&&a.media_type,"==","merchandise",n),(r||0===r)&&(t+=r),t+="\r\n    "}function p(a,e){var r,s,n="";return n+='\r\n            <div class="ds-box inner_msg orient-v send">\r\n                <div class="ds-box msg_head">\r\n                    <div class="font">',(s=d.send_user_id)?r=s.call(a,{hash:{},data:e}):(s=a&&a.send_user_id,r=typeof s===m?s.call(a,{hash:{},data:e}):s),n+=b(r)+'</div>\r\n                    <div class="font">',(s=d.send_time)?r=s.call(a,{hash:{},data:e}):(s=a&&a.send_time,r=typeof s===m?s.call(a,{hash:{},data:e}):s),n+=b(r)+'</div>\r\n                    <div class="font">',(s=d.send_hour)?r=s.call(a,{hash:{},data:e}):(s=a&&a.send_hour,r=typeof s===m?s.call(a,{hash:{},data:e}):s),n+=b(r)+'</div>\r\n                </div>\r\n                <div class="ds-box msg_body">',(s=d.content)?r=s.call(a,{hash:{},data:e}):(s=a&&a.content,r=typeof s===m?s.call(a,{hash:{},data:e}):s),n+=b(r)+"</div>\r\n            </div>\r\n        "}function v(a,e){var r,s,n="";return n+='\r\n            <div class="ds-box inner_msg orient-v send">\r\n                <div class="ds-box msg_head">\r\n                    <div class="font">',(s=d.send_user_id)?r=s.call(a,{hash:{},data:e}):(s=a&&a.send_user_id,r=typeof s===m?s.call(a,{hash:{},data:e}):s),n+=b(r)+'</div>\r\n                    <div class="font">',(s=d.send_time)?r=s.call(a,{hash:{},data:e}):(s=a&&a.send_time,r=typeof s===m?s.call(a,{hash:{},data:e}):s),n+=b(r)+'</div>\r\n                    <div class="font">',(s=d.send_hour)?r=s.call(a,{hash:{},data:e}):(s=a&&a.send_hour,r=typeof s===m?s.call(a,{hash:{},data:e}):s),n+=b(r)+'</div>\r\n                </div>\r\n                <div class="ds-box msg_body">\r\n                    <img src="',(s=d.file_url)?r=s.call(a,{hash:{},data:e}):(s=a&&a.file_url,r=typeof s===m?s.call(a,{hash:{},data:e}):s),n+=b(r)+'" style="height: 50px;" data-role="options_show_img"/>\r\n                </div>\r\n            </div>\r\n        '}function f(a,e){var r,s,n="";return n+='\r\n            <div class="ds-box inner_msg orient-v send">\r\n                <div class="ds-box msg_head">\r\n                    <div class="font">',(s=d.send_user_id)?r=s.call(a,{hash:{},data:e}):(s=a&&a.send_user_id,r=typeof s===m?s.call(a,{hash:{},data:e}):s),n+=b(r)+'</div>\r\n                    <div class="font">',(s=d.send_time)?r=s.call(a,{hash:{},data:e}):(s=a&&a.send_time,r=typeof s===m?s.call(a,{hash:{},data:e}):s),n+=b(r)+'</div>\r\n                    <div class="font">',(s=d.send_hour)?r=s.call(a,{hash:{},data:e}):(s=a&&a.send_hour,r=typeof s===m?s.call(a,{hash:{},data:e}):s),n+=b(r)+'</div>\r\n                </div>\r\n                <div class="ds-box msg_body">\r\n                    <div class="ds-box orient-v merc">\r\n                        <div class="info_title">',(s=d.card_text1)?r=s.call(a,{hash:{},data:e}):(s=a&&a.card_text1,r=typeof s===m?s.call(a,{hash:{},data:e}):s),n+=b(r)+'</div>\r\n                        <div class="info_price">',(s=d.card_text2)?r=s.call(a,{hash:{},data:e}):(s=a&&a.card_text2,r=typeof s===m?s.call(a,{hash:{},data:e}):s),n+=b(r)+"</div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        "}this.compilerInfo=[4,">= 1.0.0"],d=this.merge(d,a.helpers),s=s||{};var u,m="function",b=this.escapeExpression,y=this,g=d.helperMissing;return u=d.each.call(e,e&&e.data,{hash:{},inverse:y.noop,fn:y.program(1,n,s),data:s}),u||0===u?u:""}),n={msg_list_page:1,init:function(a){var e=this;e.contain=a.bar,e.load_success=a.load_success||function(){},e.load_fail=a.load_fail||function(){},e.click_pictures=a.click_pictures||function(){},e.render()},render:function(){var a=this,r=d();a.contain.append(r),a.panel_obj=e('[data-role="options_record_panel"]'),a.event()},show:function(){var a=this;a.panel_obj.removeClass("fn-hide"),a.panel_obj.find('[data-role="panel_head_title"]').html("聊天记录")},hide:function(){var a=this;a.panel_obj.addClass("fn-hide")},event:function(){var a=this;a.panel_head=a.panel_obj.find('[data-role="record_panel_head"]'),a.panel_head.on("mousedown",function(e){var d=e.offsetX,r=e.offsetY;a.panel_head.unbind("mousemove").on("mousemove",function(e){var s=e.offsetX,n=e.offsetY,t=s-d,o=n-r,i=a.panel_obj.css("top");i=parseInt(i.substring(0,i.indexOf("px")));var l=a.panel_obj.css("left");l=parseInt(l.substring(0,l.indexOf("px"))),a.panel_obj.css({top:i+o,left:l+t})})}),a.panel_head.on("mouseup mouseleave",function(){a.panel_head.unbind("mousemove")}),a.panel_obj.find('[data-role="record_more"]').on("click",function(){a.msg_list_page++,a.load(a.submit_obj)}),a.panel_obj.find('[data-role="record_buyer_msg"]').on("scroll",function(e){a.on_bot=e.currentTarget.scrollHeight-e.currentTarget.scrollTop})},load:function(a){var d=this;d.loading||(d.submit_obj=e.extend(!0,{},a,{page:d.msg_list_page}),d.tips_more=d.panel_obj.find('[data-role="record_more"]'),d.tips_load=d.panel_obj.find('[data-role="record_more_load"]'),d.tips_end=d.panel_obj.find('[data-role="record_more_end"]'),d.tips_more.addClass("fn-hide"),d.tips_load.removeClass("fn-hide"),d.tips_end.addClass("fn-hide"),d.submit_obj.seller_id&&e.ajax({url:window.$__ajax_domain+"get_msg_list.php",data:d.submit_obj,dataType:"json",type:"POST",cache:!1,beforeSend:function(){d.loading=!0},success:function(n){d.panel_obj.find('[data-role="panel_head_title"]').html(d.submit_obj.seller_id+"聊天记录"),d.panel_obj.find('[data-role="all_empty"]').addClass("fn-hide"),d.panel_obj.find('[data-role="record_ops"]').removeClass("fn-hide");var t=[],o=[];if(n.result_data.buyer_list.list){e.each(n.result_data.buyer_list.list,function(e,d){var r,s=JSON.parse(d);r=s.send_user_id==a.seller_id?{id:s.to_user_id,pack:s}:{id:s.send_user_id,pack:s},t.push(r)});{r({data:t})}}if(n.result_data.buyer_msg&&0!=n.result_data.buyer_msg.list.length?(d.tips_more.removeClass("fn-hide"),d.tips_load.addClass("fn-hide")):(d.tips_end.removeClass("fn-hide"),d.tips_more.addClass("fn-hide"),d.tips_load.addClass("fn-hide")),n.result_data.buyer_msg&&n.result_data.buyer_msg.list){e.each(n.result_data.buyer_msg.list,function(a,e){var d=JSON.parse(e),r=new Date(1e3*d.send_time);d.send_time=r.getFullYear()+"-"+(r.getMonth()+1)+"-"+r.getDate(),d.send_hour=r.getHours()+":"+r.getMinutes()+":"+r.getSeconds(),o.push(d)});var i=s({data:o});d.panel_obj.find('[data-role="record_buyer_msg"]').prepend(i)}d.panel_obj.find("[data-record-buyer_id]").removeClass("current"),d.panel_obj.find('[data-record-buyer_id="'+a.buyer_id+'"]').addClass("current");var l=d.panel_obj.find('[data-role="record_buyer_msg"]')[0].scrollHeight-d.on_bot;d.panel_obj.find('[data-role="record_buyer_msg"]').scrollTop(l),d._bind_event(),"function"==typeof d.load_success&&d.load_success.call(this,n,d)},error:function(a){"function"==typeof d.load_fail&&d.load_fail.call(this,a,d),d.tips_more.removeClass("fn-hide"),d.tips_load.addClass("fn-hide")},complete:function(){d.loading=!1}}))},_bind_event:function(){var a=this;a.panel_obj.find('[data-role="options_show_img"]').unbind("click").on("click",function(){var d=e(this).attr("src");"function"==typeof a.click_pictures&&a.click_pictures.call(this,d)}),e.each(a.panel_obj.find('[data-role="record_sound_line"]'),function(a,d){var r=e(d),s=r.parents("[data-record-sound-url]").attr("data-record-sound-url"),n=window.btoa(JSON.stringify({url:s}));r[0].onloadedmetadata=function(){0==r.siblings('[data-role="record_sound_click"]').find("font").length&&r.siblings('[data-role="record_sound_click"]').append("<font>"+r[0].duration.toFixed(1)+'"</font>')},r.attr("src","http://14.29.52.16:8055/ogg2mp3?req="+n)}),a.panel_obj.find('[data-role="record_play_sound"]').unbind("click").on("click",function(){var a=e(this),d=a.find('[data-role="record_sound_line"]');d[0].paused?d[0].play():d[0].pause()}),a.panel_obj.find('[data-role="record_inner_item"]').unbind("click").on("click",function(){a.panel_obj.find('[data-role="record_buyer_msg"]').html(""),a.reset_msg_list_page(),a.submit_obj=e.extend(!0,{},a.submit_obj,{buyer_id:e(this).attr("data-record-buyer_id")}),a.load(a.submit_obj)})},reset_msg_list_page:function(){var a=this;a.panel_obj.find('[data-role="record_buyer_msg"]').html(""),a.msg_list_page=1}};return n});