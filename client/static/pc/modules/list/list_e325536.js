define("list",function(e){function n(e){var n=this,e=e||{};n.$render_ele=e.ele||{},n.send_url=e.url||"",n.ajax_params=e.params||{},n.template=e.template||{},n.is_open_lazyload=null==e.is_open_lazyload?!0:!1,n.is_open_lz_opts=e.is_open_lz_opts||"",n.init(e)}var a=e("components/zepto/zepto.js"),o=e("common/utility/index"),i=(e("yue_ui/frozen"),e("../common/widget/abnormal/index")),r=e("../common/lazyload/lazyload"),t=a({});return n.prototype={refresh:function(){var e=this;e.page=1,e.action(e.page)},load_more:function(){var e=this;e._sending||(e.has_next_page?(e.page++,e.action(e.page)):e.$load_more.html("到底部了"))},init:function(){var e=this;t.$loading={},e.page=1,e.$render_ele.append('<div data-role="list"></div>'),e.$render_ele.append('<div class="ui-list-load-more-btn fn-hide" data-role="load_more">正在加载...</div>'),e.$list_container=e.$render_ele.find('[data-role="list"]'),e.$load_more=e.$render_ele.find('[data-role="load_more"]'),e.$el=e.$render_ele,e.refresh(),e.window_scroll_more()},action:function(e){var n=this;n._sending||(n.ajax_params=a.extend(n.ajax_params,{page:e}),t.ajax_obj=o.ajax_request({url:n.send_url,data:n.ajax_params,beforeSend:function(){n._sending=!0,t.$loading=a.loading({content:"加载中..."})},success:function(o){n._sending=!1;var r=o.result_data.list;if(console.log(o),n.$el.trigger("list_render:before",[n.$list_container,o]),t.$loading.loading("hide"),n.has_next_page=o.result_data.has_next_page,!r.length&&1==e)return i.render(n.$render_ele[0],{}),void n.$load_more.addClass("fn-hide");n.$load_more.removeClass("fn-hide");var l=n.template({list:r});n.$list_container.append(l),n.$el.trigger("list_render:after",[n.$list_container,o,a(l)]),n.setup_event()},error:function(){n._sending=!1,t.$loading.loading("hide"),a.tips({content:"网络异常",stayTime:3e3,type:"warn"})}}))},window_scroll_more:function(){var e=this;a(window).scroll(function(){a(window).scrollTop()+a(window).height()>a(document).height()-50&&e.load_more()})},setup_event:function(){var e=this;if(e.is_open_lazyload)if(e.lazyloading)e.lazyloading.refresh();else{var n={size:window.innerWidth};e.is_open_lz_opts||(n={}),e.lazyloading=new r(a("body"),n)}e.$render_ele.height()<window.innerHeight&&e.$load_more.addClass("fn-hide")}},n});